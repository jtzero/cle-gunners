---
import { Image } from "astro:assets";
import menu from "@/config/menu.json";

import { fromBase } from "@/lib/fromBase";

export interface ChildNavigationLink {
  name: string;
  url: string;
}

export interface NavigationLink {
  name: string;
  url: string;
  hasChildren?: boolean;
  jsCloseMenu?: boolean;
  children?: ChildNavigationLink[];
}

const { main }: { main: NavigationLink[] } = menu;
---

<header class="header">
  <nav
    id="nav-container"
    data-testid="nav-container"
    class="fixed flex flex-col items-center justify-center"
  >
    <div id="nav-toggler" data-testid="nav-toggler" class="self-start">
      <input
        id="nav-toggle"
        data-name="nav-toggle"
        data-testid="nav-toggle"
        type="checkbox"
        class="hidden"
      />
      <label
        id="show-button"
        data-testid="show-button"
        for="nav-toggle"
        class="show-button"
      >
        <svg class="size-[calc(1.5rem+1.5vw)] fill-white" viewBox="0 0 20 20">
          <title>Menu Open</title>
          <path d="M0 3h20v2H0V3z m0 6h20v2H0V9z m0 6h20v2H0V0z"></path>
        </svg>
      </label>
      <label
        id="hide-button"
        data-testid="hide-button"
        for="nav-toggle"
        class="hide-button"
      >
        <svg class="size-[calc(1.5rem+1.5vw)] fill-white" viewBox="0 0 20 20">
          <title>Menu Close</title>
          <polygon
            points="11 9 22 9 22 11 11 11 11 22 9 22 9 11 -2 11 -2 9 9 9 9 -2 11 -2"
            transform="rotate(45 10 10)"></polygon>
        </svg>
      </label>
    </div>
    <ul id="nav-menu" data-testid="nav-menu" class="nav-menu">
      {
        main.map((menu) => (
          <li class="flex justify-center border-white py-4">
            <a
              data-js-close={menu.jsCloseMenu}
              id={menu.name}
              href={fromBase(menu.url)}
              class="text-center text-4xl"
            >
              {menu.name}
            </a>
          </li>
        ))
      }
    </ul>
  </nav>

  <div id="banner" data-testid="banner">
    <div id="banner-split" data-testid="banner-split">
      <p class="w-[96px] self-end text-center sm:w-[15vw]">CLEVELAND</p>
      <div class="logo-container">
        <div
          id="logo-base"
          data-testid="logo-base"
          class="circle flex size-99/100 items-center justify-center bg-white"
        >
          {
            (
              <Image
                src={fromBase("/images/banner/arsenal-guardian.png")}
                width={2007}
                height={2008}
                alt="CLE-GUNNERS"
                class="size-99.5/100"
              />
            )
          }
        </div>
      </div>
      <p class="w-[96px] self-end text-center sm:w-[15vw]">ARSENAL</p>
    </div>
  </div>
</header>
<style>
  @import "@/styles/tailwind.css";

  :root {
    --toggler-size: size-[calc(1.5rem+1.5vw)];
  }
  @theme {
    --color-menu: var(--color-blue);
  }

  .header {
    @apply top-0 left-0 z-40 w-full pb-[calc(3.5vw+1.5rem)] transition-all duration-300;
    @apply bg-body;
  }

  #banner {
    @apply bg-dark-red h-30 w-full text-[calc(0.5rem+2vw)] font-bold text-white sm:h-40 md:h-50 lg:h-60 xl:h-64;
  }

  #banner-split {
    @apply flex h-[70%] justify-evenly border-b-1 border-white xl:h-37;
  }

  .logo-container {
    @apply flex h-[9rem] w-[9rem] self-baseline;
    @apply sm:h-[12rem] sm:w-[12rem];
    @apply md:h-[15rem] md:w-[15rem];
    @apply lg:h-[18rem] lg:w-[18rem];
    @apply xl:h-[19rem] xl:w-[19rem];
  }

  .circle {
    border-radius: 50%;
  }

  #nav-toggler {
    @apply bg-gold mt-[0.5vw] mb-[2vw] ml-[2vw] flex size-[calc(2rem+3vw)] items-center justify-center shadow-xl/30;
    border-radius: 50%;
  }

  #nav-container:has(> input#nav-toggle:checked) {
    @apply border-1 border-blue-300;
  }

  input#nav-toggle:checked ~ label#show-button {
    @apply hidden;
  }

  input#nav-toggle:checked ~ label#hide-button {
    @apply flex;
  }

  .show-button {
    @apply order-2 flex size-[100%] cursor-pointer items-center justify-center md:order-1;
  }

  .hide-button {
    @apply order-2 flex hidden size-[100%] cursor-pointer items-center justify-center md:order-1;
  }

  #nav-container {
    @apply sm:max-w-[25rem];
  }

  #nav-container:has(input#nav-toggle:checked) > #nav-menu {
    @apply block w-full;
  }

  #nav-container:has(input#nav-toggle:checked) {
    @apply bg-menu shadow-menu w-full shadow-2xl/90;
    @apply border-1 border-blue-300;
  }

  #nav-container:has(> a:active) > #nav-menu {
    @apply hidden;
  }

  .nav-menu {
    background-color: transparent;
    padding-bottom: var(--text-4xl);
    @apply hidden w-full max-w-[20rem] text-white;
  }
</style>
<script>
  import scope from "astro:scope";
  document.addEventListener("astro:page-load", () => {
    const self = document.querySelector(`[data-astro-cid-${scope}]`);
    const navToggle = self!.querySelector(
      '[data-name="nav-toggle"]',
    ) as HTMLInputElement;
    navToggle.addEventListener("change", function () {
      if (this.checked) {
        document.body.classList.add("overflow-hidden");
      } else {
        document.body.classList.remove("overflow-hidden");
      }
    });
    [...self!.querySelectorAll("[data-js-close=true]")].map((navItem) => {
      navItem.addEventListener("click", () => {
        navToggle!.checked = false;
      });
    });
  });
</script>
